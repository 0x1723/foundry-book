<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js ayu">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Cheatcodes - Foundry Book</title>
        <!-- Custom HTML head -->
        <meta name="twitter:card" content="summary">
        <meta property="og:title" content="Foundry Book" />
        <meta property="og:description" content="A book on all things Foundry" />
        <meta name="twitter:image:src" content="https://raw.githubusercontent.com/onbjerg/foundry-book/master/theme/card.png" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="A book on all things Foundry">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../src/static/custom.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Getting Started</li><li class="chapter-item expanded "><a href="../getting-started/installation.html">Installation</a></li><li class="chapter-item expanded "><a href="../getting-started/first-steps.html">First Steps with Foundry</a></li><li class="chapter-item expanded affix "><li class="part-title">Projects</li><li class="chapter-item expanded "><a href="../projects/creating-a-new-project.html">Creating a New Project</a></li><li class="chapter-item expanded "><a href="../projects/working-on-an-existing-project.html">Working on an Existing Project</a></li><li class="chapter-item expanded "><a href="../projects/dependencies.html">Dependencies</a></li><li class="chapter-item expanded "><a href="../projects/project-layout.html">Project Layout</a></li><li class="chapter-item expanded affix "><li class="part-title">Forge Overview</li><li class="chapter-item expanded "><a href="../forge/index.html">Overview of forge</a></li><li class="chapter-item expanded "><a href="../forge/tests.html">Tests</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../forge/writing-tests.html">Writing Tests</a></li><li class="chapter-item expanded "><a href="../forge/cheatcodes.html" class="active">Cheatcodes</a></li><li class="chapter-item "><a href="../forge/traces.html">Understanding Traces</a></li><li class="chapter-item "><a href="../forge/forking-mode.html">Forking Mode</a></li></ol></li><li class="chapter-item expanded "><a href="../forge/advanced-testing.html">Advanced Testing</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../forge/fuzz-testing.html">Fuzz Testing</a></li></ol></li><li class="chapter-item expanded "><a href="../forge/deploying.html">Deploying and Verifying</a></li><li class="chapter-item expanded "><div>Gas Tracking</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../forge/gas-reports.html">Gas Reports</a></li></ol></li><li class="chapter-item expanded "><a href="../forge/debugger.html">Debugger</a></li><li class="chapter-item expanded affix "><li class="part-title">Cast Overview</li><li class="chapter-item expanded "><a href="../cast/index.html">Overview of cast</a></li><li class="chapter-item expanded affix "><li class="part-title">Configuration</li><li class="chapter-item expanded "><a href="../config/index.html">Configuring with foundry.toml</a></li><li class="chapter-item expanded "><a href="../config/continous-integration.html">Continuous Integration</a></li><li class="chapter-item expanded "><a href="../config/vscode.html">Integrating with VSCode</a></li><li class="chapter-item expanded "><a href="../config/shell-autocompletion.html">Shell Autocompletion</a></li><li class="chapter-item expanded affix "><li class="part-title">Tutorials</li><li class="chapter-item expanded "><a href="../tutorials/solmate-nft.html">Creating an NFT with Solmate</a></li><li class="chapter-item expanded "><a href="../tutorials/foundry-docker.html">Docker and Foundry</a></li><li class="chapter-item expanded affix "><li class="part-title">Appendix</li><li class="chapter-item expanded "><div>FAQ</div></li><li class="chapter-item expanded "><div>References</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>forge Reference</div></li><li class="chapter-item "><a href="../reference/cast.html">cast Reference</a></li><li class="chapter-item "><a href="../reference/config.html">foundry.toml Reference</a></li><li class="chapter-item "><a href="../reference/ds-test.html">ds-test Reference</a></li><li class="chapter-item "><a href="../cheatcodes/index.html">Cheatcodes Reference</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cheatcodes/environment.html">Environment</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cheatcodes/warp.html">warp</a></li><li class="chapter-item "><a href="../cheatcodes/roll.html">roll</a></li><li class="chapter-item "><a href="../cheatcodes/fee.html">fee</a></li><li class="chapter-item "><a href="../cheatcodes/store.html">store</a></li><li class="chapter-item "><a href="../cheatcodes/load.html">load</a></li><li class="chapter-item "><a href="../cheatcodes/etch.html">etch</a></li><li class="chapter-item "><a href="../cheatcodes/deal.html">deal</a></li><li class="chapter-item "><a href="../cheatcodes/prank.html">prank</a></li><li class="chapter-item "><a href="../cheatcodes/start-prank.html">startPrank</a></li><li class="chapter-item "><a href="../cheatcodes/stop-prank.html">stopPrank</a></li><li class="chapter-item "><a href="../cheatcodes/record.html">record</a></li><li class="chapter-item "><a href="../cheatcodes/accesses.html">accesses</a></li><li class="chapter-item "><a href="../cheatcodes/set-nonce.html">setNonce</a></li><li class="chapter-item "><a href="../cheatcodes/get-nonce.html">getNonce</a></li><li class="chapter-item "><a href="../cheatcodes/mock-call.html">mockCall</a></li><li class="chapter-item "><a href="../cheatcodes/clear-mocked-calls.html">clearMockedCalls</a></li></ol></li><li class="chapter-item "><a href="../cheatcodes/assertions.html">Assertions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cheatcodes/expect-revert.html">expectRevert</a></li><li class="chapter-item "><a href="../cheatcodes/expect-emit.html">expectEmit</a></li><li class="chapter-item "><a href="../cheatcodes/expect-call.html">expectCall</a></li></ol></li><li class="chapter-item "><a href="../cheatcodes/fuzzer.html">Fuzzer</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cheatcodes/assume.html">assume</a></li></ol></li><li class="chapter-item "><a href="../cheatcodes/external.html">External</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cheatcodes/ffi.html">ffi</a></li><li class="chapter-item "><a href="../cheatcodes/get-code.html">getCode</a></li></ol></li><li class="chapter-item "><a href="../cheatcodes/utilities.html">Utilities</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cheatcodes/addr.html">addr</a></li><li class="chapter-item "><a href="../cheatcodes/sign.html">sign</a></li><li class="chapter-item "><a href="../cheatcodes/label.html">label</a></li></ol></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu (default)</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Foundry Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/onbjerg/foundry-book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/onbjerg/foundry-book/edit/master/src/forge/cheatcodes.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="cheatcodes"><a class="header" href="#cheatcodes">Cheatcodes</a></h2>
<p>Most of the time, simply testing your smart contracts outputs isn't enough. To manipulate the state of the blockchain, as well as test for specific reverts and events, Foundry is shipped with a set of cheatcodes.</p>
<p>Cheatcodes allow you to change the block number, your identity, and more. They are invoked by calling specific functions on a specially designated address: <code>0x7109709ECfa91a80626fF3989D68f67F5b1DD12D</code>. If you are using <code>ds-test</code>, then this address is assigned in a constant named <code>HEVM_ADDRESS</code>.</p>
<p>Let's write a test for a smart contract that is only callable by its owner.</p>
<pre><code class="language-solidity">pragma solidity 0.8.10;

import &quot;ds-test/test.sol&quot;;

error Unauthorized();

contract OwnerUpOnly {
    address public immutable owner;
    uint256 public count;

    constructor() {
        owner = msg.sender;
    }

    function increment() external {
        if (msg.sender != owner) {
            revert Unauthorized();
        }
        count++;
    }
}

contract OwnerUpOnlyTest is DSTest {
    OwnerUpOnly upOnly;

    function setUp() public {
        upOnly = new OwnerUpOnly();
    }

    function testIncrementAsOwner() public {
        assertEq(upOnly.count(), 0);
        upOnly.increment();
        assertEq(upOnly.count(), 1);
    }
}
</code></pre>
<p>If we run <code>forge test</code> now, we will see that the test passes, since <code>OwnerUpOnlyTest</code> is the owner of <code>OwnerUpOnly</code>.</p>
<pre><code class="language-ignore">$ forge test
Compiling 3 files with 0.8.10
Compiler run successful

Running 1 test for src/test/OwnerUpOnly.t.sol:OwnerUpOnlyTest
[PASS] testIncrementAsOwner() (gas: 29332)
Test result: ok. 1 passed; 0 failed; finished in 233.70µs
</code></pre>
<p>Let's make sure that someone who is definitely not the owner can't increment the count:</p>
<pre><code class="language-solidity">interface CheatCodes {
    function prank(address) external;
}

contract OwnerUpOnlyTest is DSTest {
    OwnerUpOnly upOnly;

    // ...

    function testFailIncrementAsNotOwner() public {
        cheats.prank(address(0));
        upOnly.increment();
    }
}
</code></pre>
<p>If we run <code>forge test</code> now, we will see that all the test pass.</p>
<pre><code class="language-ignore">$ forge test
No files changed, compilation skipped

Running 2 tests for src/test/OwnerUpOnly.t.sol:OwnerUpOnlyTest
[PASS] testFailIncrementAsNotOwner() (gas: 10510)
[PASS] testIncrementAsOwner() (gas: 29332)
Test result: ok. 2 passed; 0 failed; finished in 247.79µs
</code></pre>
<p>The test passed because the <code>prank</code> cheatcode changed our identity to the zero address for the next call (<code>upOnly.increment()</code>). The test case passed since we used the <code>testFail</code> prefix, however, using <code>testFail</code> is considered an anti-pattern since it does not tell us anything about <em>why</em> <code>upOnly.increment()</code> reverted.</p>
<p>If we run the tests again with traces turned on, we can see that we reverted with the correct error message.</p>
<pre><code class="language-ignore">$ forge test -vvvv --match-test testFailIncrementAsNotOwner
No files changed, compilation skipped

Running 1 test for src/test/OwnerUpOnly.t.sol:OwnerUpOnlyTest
[PASS] testFailIncrementAsNotOwner() (gas: 10510)
Traces:
  [10510] OwnerUpOnlyTest::testFailIncrementAsNotOwner() 
    ├─ [0] VM::prank(0x0000000000000000000000000000000000000000) 
    │   └─ ← ()
    ├─ [247] 0xce71…c246::d09de08a() 
    │   └─ ← 0x82b42900
    └─ ← 0x82b42900

Test result: ok. 1 passed; 0 failed; finished in 204.44µs
</code></pre>
<p>To be sure in the future, let's make sure that we reverted because we are not the owner using the <code>expectRevert</code> cheatcode:</p>
<pre><code class="language-solidity">interface CheatCodes {
    function prank(address) external;
    function expectRevert(bytes4) external;
}

contract OwnerUpOnlyTest is DSTest {
    OwnerUpOnly upOnly;

    // ...

    // Notice that we replaced `testFail` with `test`
    function testIncrementAsNotOwner() public {
        cheats.expectRevert(Unauthorized.selector);
        cheats.prank(address(0));
        upOnly.increment();
    }
}
</code></pre>
<p>If we run <code>forge test</code> one last time, we see that the test still passes, but this time we are sure that it will always fail if we revert for any other reason.</p>
<pre><code class="language-ignore">$ forge test
No files changed, compilation skipped

Running 2 tests for src/test/OwnerUpOnly.t.sol:OwnerUpOnlyTest
[PASS] testIncrementAsNotOwner() (gas: 10882)
[PASS] testIncrementAsOwner() (gas: 29332)
Test result: ok. 2 passed; 0 failed; finished in 233.22µs
</code></pre>
<p>Another cheatcode that is perhaps not so intuitive is the <code>expectEmit</code> function. Before looking at <code>expectEmit</code>, we need to understand what an event is.</p>
<p>Events are inheritable members of contracts. When you emit an event, the arguments are stored on the blockchain. The <code>indexed</code> attribute can be added to a maximum of three parameters of an event to form a data structure known as a &quot;topic.&quot; Topics allow users to search for events on the blockchain.</p>
<pre><code class="language-solidity">pragma solidity 0.8.10;

import &quot;ds-test/test.sol&quot;;

interface CheatCodes {
    function expectEmit(
        bool,
        bool,
        bool,
        bool
    ) external;
}

contract EmitContractTest is DSTest {
    event Transfer(address indexed from, address indexed to, uint256 amount);
    CheatCodes constant cheats = CheatCodes(HEVM_ADDRESS);

    function testExpectEmit() public {
        ExpectEmit emitter = new ExpectEmit();
        // Check that topic 1, topic 2, and data are the same as the following emitted event.
        // Checking topic 3 here doesn't matter, because `Transfer` only has 2 indexed topics.
        cheats.expectEmit(true, true, false, true);
        // The event we expect
        emit Transfer(address(this), address(1337), 1337);
        // The event we get
        emitter.t();
    }

    function testExpectEmitDoNotCheckData() public {
        ExpectEmit emitter = new ExpectEmit();
        // Check topic 1 and topic 2, but do not check data
        cheats.expectEmit(true, true, false, false);
        // The event we expect
        emit Transfer(address(this), address(1337), 1338);
        // The event we get
        emitter.t();
    }
}

contract ExpectEmit {
    event Transfer(address indexed from, address indexed to, uint256 amount);

    function t() public {
        emit Transfer(msg.sender, address(1337), 1337);
    }
}
</code></pre>
<p>When we call <code>cheats.expectEmit(true, true, false, true);</code>, we want to check the 1st and 2nd <code>indexed</code> topic for the next event.</p>
<p>The expected <code>Transfer</code> event in <code>testExpectEmit()</code> means we are expecting that <code>from</code> is  <code>address(this)</code>, and <code>to</code> is <code>address(1337)</code>. This is compared against the event emitted from <code>emitter.t()</code>.</p>
<p>In other words, we are checking that the first topic from <code>emitter.t()</code> is equal to <code>address(this)</code>. The 3rd argument in <code>expectEmit</code> is set to <code>false</code> because there is no need to check the third topic in the <code>Transfer</code> event, since there are only two. It does not matter even if we set to <code>true</code>.</p>
<p>The 4th argument in <code>expectEmit</code> is set to <code>true</code>, which means that we want to check &quot;non-indexed topics&quot;, also known as data.</p>
<p>For example, we want the data from the expected event in <code>testExpectEmit</code> - which is <code>amount</code> - to equal to the data in the actual emitted event. In other words, we are asserting that <code>amount</code> emitted by <code>emitter.t()</code> is equal to <code>1337</code>. If the fourth argument in <code>expectEmit</code> was set to <code>false</code>, we would not check <code>amount</code>.</p>
<p>In other words, <code>testExpectEmitDoNotCheckData</code> is a valid test case, even though the amounts differ, since we do not check the data.</p>
<br>
<blockquote>
<p>📚 <strong>Reference</strong></p>
<p>See the <a href="../cheatcodes">Cheatcodes Reference</a> for a complete overview of all the available cheatcodes.</p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../forge/writing-tests.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../forge/traces.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../forge/writing-tests.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../forge/traces.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../src/static/solidity.min.js"></script>
    </body>
</html>
